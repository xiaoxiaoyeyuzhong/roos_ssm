<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gec.roos.dao.OrderMapper">
    <!-- 查询已支付未消费订单 -->
    <select id="queryPaidOrderDetail" parameterType="string" resultMap="orderResultMap">
        select o.orderid, o.openid, o.state, o.payment, o.isexpend, o.eatdate, o.create_time as o_create_time,
               d.id, d.orderid as d_orderid, d.number, d.fid, d.create_time as d_create_time,
               f.fid as f_fid, f.typeid, f.foodName, f.picurl, f.foodPrice, f.foodVIP, f.integral, f.feature, f.create_time as f_create_time
        from orders o
                 JOIN orderfo d ON(o.orderid = d.orderid)
                 JOIN food f ON(d.fid = f.fid)
        where o.openid=#{openid}
          and o.payment='支付宝支付'
          and o.isexpend='未消费'
        order by o.create_time desc
    </select>

    <resultMap type="Order" id="orderResultMap">
        <id property="orderid" column="orderid"/>
        <result property="openid" column="openid"/>
        <result property="state" column="state"/>
        <result property="payment" column="payment"/>
        <result property="isexpend" column="isexpend"/>
        <result property="eatdate" column="eatdate"/>
        <result property="create_time" column="o_create_time"/>
        <collection property="odf" ofType="OrderFo">
            <id property="id" column="id"/>
            <result property="orderid" column="d_orderid"/>
            <result property="number" column="number"/>
            <result property="fid" column="fid"/>
            <result property="create_time" column="d_create_time"/>
            <result property="sum_money" column="sum_money"/>
                <association property="food" javaType="Food">
                <id property="fid" column="f_fid"/>
                <result property="typeid" column="typeid"/>
                <result property="foodName" column="foodName"/>
                <result property="picurl" column="picurl"/>
                <result property="foodPrice" column="foodPrice"/>
                <result property="foodVIP" column="foodVIP"/>
                <result property="integral" column="integral"/>
                <result property="feature" column="feature"/>
                <result property="create_time" column="f_create_time"/>
            </association>
        </collection>
    </resultMap>
</mapper>
